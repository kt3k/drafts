# Deno の Op について

<!--
想定読者:
- Deno の内部構造に興味がある人
- Deno の中身を読んでみたいけれど, どこから何を読んで良いのか分からない人
- ソースを読む前になんらかの大きな全体像を掴みたいと思っている人
-->

Deno Advent Calendar 21日目の記事です.

今日は Deno の Op という単位について説明します.

# Op とは

Op は Deno の機能を作るための基本的な単位です.

Deno の JavaScript エンジン (deno::Isolate = V8) と Rust で書かれたメインプロセスは Op という単位のリクエスト/レスポンスを送受信する事で, 様々な処理を実行しています.

<img src="" />

Op は V8 から Rust 側の機能を呼び出す際の gateway のような役割を果たしていて, この Op を発行するタイミングで Deno はランタイムが適切な Permission を持っているかをチェックします. たとえば read_file op を発行した場合は適切な `read` パーミッションを持っているかどうかをチェックします. パーミッションがなければ, このタイミングで PermissionDenied が throw され readFile 呼び出しは失敗し, パーミッションを持っていた場合のみ, 実際に Op が実行されます.

# Op の実装

ここでは, 具体的に, 各 Op がどのように実装されているかを見ましょう.

# どんな Op があるか

以下に, 現在 Deno が持っている Op を列挙します. Op は今後も追加されていく可能性が濃厚です.

# Op を追加するには

以下の手順で Op を追加する事が出来ます.

# Native Plugin

Deno 0.26.0 で Native Plugin という機能が実装されました. この機能を使うと, ランタイムに動的に Op を追加する事が出来ます. 以下に, hello という自明な Op を追加する例を示します.

# Op に関するロードマップ

Op については少し大きめのロードマップがあります. 将来的に Deno チームは全ての Op を個別の crate として, crates.io

# まとめ

今日は Deno の Op について説明しました.

明日は @nana4goto さんの記事です.
